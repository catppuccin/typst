name: CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

  workflow_dispatch:

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: ‚öôÔ∏è Setup Typst
        uses: typst-community/setup-typst@v4
        id: setup-typst
        with:
          typst-version: v0.13.0
          cache-dependency-path: examples/requirements.typ

      - name: ‚öôÔ∏è Install typstyle
        run: cargo install typstyle --locked

      - name: üßπ Check style
        run: find . -name "*.typ" | xargs typstyle --check -c 80

      - name: üõ†Ô∏è Compile test document
        run: typst compile examples/demo.typ --root .

      - name: üõ†Ô∏è Compile manual
        run: |
          wget -qO logo.png "https://raw.githubusercontent.com/catppuccin/catppuccin/08946855002032919592a7c8d49204a7a59c30f9/assets/logos/exports/1544x1544_circle.png"
          typst compile --root . \
            --font-path ./fonts \
            --input flavor="mocha" \
            --input logo="logo.png" \
            --font-path=~/.fontist \
            manual/manual.typ
