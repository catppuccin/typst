name: CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

  workflow_dispatch:

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: ‚öôÔ∏è Setup Typst
        uses: typst-community/setup-typst@v4
        id: setup-typst
        with:
          # Version depends on requirements.typ versions.
          # It is higher than typst.toml because the manual cannot build
          # without a dependency to Cetz.
          typst-version: v0.13.1
          cache-dependency-path: examples/requirements.typ

      - name: ‚öôÔ∏è Install typstyle
        run: cargo install typstyle --locked

      - name: üßπ Check style
        run: find . -name "*.typ" | xargs typstyle --check -c 80

      - name: üõ†Ô∏è Compile test document
        run: typst compile examples/demo.typ --root .

      - name: üõ†Ô∏è Compile manual
        run: |
          typst compile --root . \
            --font-path ./fonts \
            --input flavor="mocha" \
            --input logo="/assets/logos/logo_dark.png" \
            --font-path=~/.fontist \
            manual/manual.typ
